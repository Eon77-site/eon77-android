name: Build AION APK

on:
  workflow_dispatch: # Permite que você dê o "Play" manualmente

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout do Código
        uses: actions/checkout@v3

      - name: Configurar Java JDK
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'

      - name: Instalar Dependências do Sistema
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            git \
            python3-dev \
            python3-pip \
            libffi-dev \
            libssl-dev \
            libsqlite3-dev \
            sqlite3 \
            unzip \
            zip \
            zlib1g-dev \
            openjdk-11-jdk \
            cmake \
            autoconf \
            libtool \
            pkg-config

      - name: Instalar Buildozer e Cython
        run: |
          pip3 install --user --upgrade buildozer cython==0.29.33 virtualenv

      - name: Adicionar Buildozer ao PATH
        run: echo "/home/runner/.local/bin" >> $GITHUB_PATH

      - name: Construir APK da AION (Processo Nó 0)
        run: |
          yes | buildozer -v android debug
        env:
          ACCEPT_SDK_LICENSE: "y"

      - name: Upload do APK Pronto
        uses: actions/upload-artifact@v3
        with:
          name: AION-Network-Debug-APK
          path: bin/*.apk
